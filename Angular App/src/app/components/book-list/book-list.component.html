<div class="container mt-4 position-relative">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">Book Store Management</h2>
      
      <!-- Add New Book Button -->
      <div class="mb-3">
        <button 
          class="btn btn-primary" 
          (click)="startAddNew()" 
          [disabled]="isAddingNew || editingBookId !== null || loading">
          <i class="bi bi-plus-circle"></i> Add New Book
        </button>
      </div>

      <!-- Loading Overlay -->
      <div *ngIf="loading" class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background:rgba(255,255,255,0.6); z-index:10;">
        <div class="text-center">
          <div class="spinner-border text-primary mb-2" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div class="small text-muted">Processing...</div>
        </div>
      </div>

      <!-- Books Table -->
      <div class="table-responsive" [class.opacity-50]="loading">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Author</th>
              <th>ISBN</th>
              <th>Price</th>
              <th>Published Date</th>
              <th>Genre</th>
              <th>In Stock</th>
              <th class="table-actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Add New Book Row -->
            <tr *ngIf="isAddingNew" class="table-success">
              <td>-</td>
              <td>
                <input 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.title" 
                  placeholder="Enter title">
              </td>
              <td>
                <input 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.author" 
                  placeholder="Enter author">
              </td>
              <td>
                <input 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.isbn" 
                  placeholder="Enter ISBN">
              </td>
              <td>
                <input 
                  type="number" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.price" 
                  placeholder="0.00" 
                  step="0.01">
              </td>
              <td>
                <input 
                  type="date" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.publishedDate">
              </td>
              <td>
                <input 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="newBook.genre" 
                  placeholder="Enter genre">
              </td>
              <td>
                <select class="form-select form-select-sm" [(ngModel)]="newBook.inStock">
                  <option [value]="true">Yes</option>
                  <option [value]="false">No</option>
                </select>
              </td>
              <td class="table-actions">
                <button 
                  class="btn btn-success btn-sm me-1" 
                  (click)="saveNewBook()"
                  [disabled]="!validateNewBook() || loading">
                  Save
                </button>
                <button 
                  class="btn btn-secondary btn-sm" 
                  (click)="cancelEdit()" [disabled]="loading">
                  Cancel
                </button>
              </td>
            </tr>

            <!-- Existing Books Rows -->
            <tr *ngFor="let book of books" [class.table-warning]="isEditing(book.id)">
              <td>{{ book.id }}</td>
              
              <!-- Title -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  {{ book.title }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.title">
              </td>
              
              <!-- Author -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  {{ book.author }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.author">
              </td>
              
              <!-- ISBN -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  {{ book.isbn }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.isbn">
              </td>
              
              <!-- Price -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  ${{ book.price | number:'1.2-2' }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="number" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.price" 
                  step="0.01">
              </td>
              
              <!-- Published Date -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  {{ book.publishedDate | date:'shortDate' }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="date" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.publishedDate">
              </td>
              
              <!-- Genre -->
              <td class="editable-cell">
                <span *ngIf="!isEditing(book.id)" (click)="startEdit(book)">
                  {{ book.genre }}
                </span>
                <input 
                  *ngIf="isEditing(book.id)" 
                  type="text" 
                  class="form-control form-control-sm" 
                  [(ngModel)]="editingBook!.genre">
              </td>
              
              <!-- In Stock -->
              <td class="editable-cell">
                <span 
                  *ngIf="!isEditing(book.id)" 
                  (click)="startEdit(book)"
                  [class]="book.inStock ? 'badge bg-success' : 'badge bg-danger'">
                  {{ book.inStock ? 'Yes' : 'No' }}
                </span>
                <select 
                  *ngIf="isEditing(book.id)" 
                  class="form-select form-select-sm" 
                  [(ngModel)]="editingBook!.inStock">
                  <option [value]="true">Yes</option>
                  <option [value]="false">No</option>
                </select>
              </td>
              
              <!-- Actions -->
              <td class="table-actions">
                <div *ngIf="!isEditing(book.id)">
                  <button 
                    class="btn btn-outline-primary btn-sm me-1" 
                    (click)="startEdit(book)"
                    [disabled]="editingBookId !== null || isAddingNew || loading">
                    Edit
                  </button>
                  <button 
                    class="btn btn-outline-danger btn-sm" 
                    (click)="deleteBook(book.id)"
                    [disabled]="editingBookId !== null || isAddingNew || loading">
                    Delete
                  </button>
                </div>
                
                <div *ngIf="isEditing(book.id)">
                  <button 
                    class="btn btn-success btn-sm me-1" 
                    (click)="saveEdit()" [disabled]="loading">
                    Save
                  </button>
                  <button 
                    class="btn btn-secondary btn-sm" 
                    (click)="cancelEdit()" [disabled]="loading">
                    Cancel
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- No books message -->
      <div *ngIf="books.length === 0" class="alert alert-info text-center">
        <h5>No books found</h5>
        <p>Click "Add New Book" to get started!</p>
      </div>
    </div>
  </div>
</div>